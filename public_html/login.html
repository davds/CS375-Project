<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <!--link rel="stylesheet" type="text/css" href="style.css"-->
  <title>Login</title>
  
  <style>
    .login-register {
      margin: auto;
      text-align: center;
      width: 500px;
    }
    input {
      margin: 5px !important;
    }
  </style>
</head>

<body>
  <div id="header"></div>
  <div class="login-register">
    <div id="login">
      <form onsubmit="return false;">
        <input type="text" class="form-control" placeholder="Username" id="username-input" />      
        <input type="password" class="form-control" placeholder="Password" id="password-input" />
        <input type="submit" class="btn btn-secondary" id="login-button" value="Login" />
        <p>Need to register? <a href="#register" onclick="switchLoginRegister(false);">Click here</a></p>  
      </form>  
    </div>
    <div id="register" style="display: none">    
      <form onsubmit="return false;">
        <input type="text" class="form-control" placeholder="Username" id="username-input-register" />    
        <input type="text" class="form-control" placeholder="Email (ex. conway@mail.com)" id="email-input-register" />    
        <input type="password" class="form-control" placeholder="Password" id="password-input-register" />
        <input type="password" class="form-control" placeholder="Password" id="cpassword-input-register" />
        <input type="submit" class="btn btn-secondary" id="register-button" value="Register" />      
        <p><a href="#login" onclick="switchLoginRegister(true);">I already have an account</a></p>
      </form>      
    </div>
    <p id="status"></p> 
  </div>
   



  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="./client.js"></script>
  <script> 
    $("#header").load("header.html");
    
    let loginScreen = document.getElementById("login");
    let registerScreen = document.getElementById("register");

    let usernameInput = document.getElementById("username-input");
    let passwordInput = document.getElementById("password-input");
    let status = document.getElementById("status");
    document.getElementById("login-button").addEventListener("click", function () {
      fetch("/auth", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          username: usernameInput.value,
          plaintextPassword: passwordInput.value,
        })
      }).then(function (response) {
          return response.text()
      }).then(function (data) {
          status.textContent = data
      })
    });

    let usernameInputRegister = document.getElementById("username-input-register");
    let emailInputRegister = document.getElementById("email-input-register");
    let passwordInputRegister = document.getElementById("password-input-register");
    let cpasswordInputRegister = document.getElementById("cpassword-input-register");
    document.getElementById("register-button").addEventListener("click", function () {
        if (passwordInputRegister.value === cpasswordInputRegister.value){
            fetch("/newUser", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                username: usernameInputRegister.value,
                email: emailInputRegister.value,
                plaintextPassword: passwordInputRegister.value,
            })
            }).then(function (response) {
                return response.text()
            }).then(function (data) {
                status.textContent = data
            })
        } else {
            status.textContent = "Passwords do not match.";
        }        
    });

    function switchLoginRegister(login) {
      if (login) {
        loginScreen.style.display = "block";
        registerScreen.style.display = "none";
      } else {
        
        loginScreen.style.display = "none";
        registerScreen.style.display = "block";
      }
    }    
  </script>
</body>
</html>